---
title: "starve-langevin"
output: rmarkdown::html_vignette
vignette: >
    %\VignetteIndexEntry{starve-langevin}
    %\VignetteEnging{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>"
)
```

```{r setup}
library(npmlangevin)
set.seed(5108)
```

```{r simulate}
sim<- simulate(
    nt = 500,
    nping = 400,
    boundary_sharpness = 0,
    boundary_limit = 1,
    pred_loc_delta = 0.5,
    ping_tau = 0.1 * c(1, 1),
    gamma = 0.1,
    cv_code = 1,
    cv_pars = c(0.2, 0.3, 1),
    loc_class_probs = c(
        G = 0.1,
        `3` = 0.2,
        `2` = 0.2,
        `1` = 0.2,
        `0` = 0.2,
        A = 0.1,
        B = 0
    )
)
```

```{r}
print(
    with(
        sim$tmap,
        {
            tmap_arrange(
                pred_field + track + pings,
                pred_util + track + pings,
                nrow = 2
            )
        }
    )
)
```


# Data pre-processing

## Fit a random walk to filter locations

```{r}
filtered_locations<- fit_rw(
    locations = sim$pings,
    delta_t = 1
)
```

```{r}
filtered_tm<- tm_shape(
        st_cast(st_combine(filtered_locs$track), "LINESTRING")
    ) + tm_lines(col = "red")
filtered_tm + sim$tmap$track + sim$tmap$pings
```

## Find the observed location differences